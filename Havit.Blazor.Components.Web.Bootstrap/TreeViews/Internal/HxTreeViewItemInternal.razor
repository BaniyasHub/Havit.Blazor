@namespace Havit.Blazor.Components.Web.Bootstrap.Internal
@typeparam TItem

@{
    var icon = SelectorHelpers.GetValue<TItem, IconBase>(this.IconSelector, this.Item);
    var title = SelectorHelpers.GetText(this.TitleSelector, this.Item);
    var children = SelectorHelpers.GetValue<TItem, IEnumerable<TItem>>(this.ChildrenSelector, this.Item);
    var hasChildren = children?.Any() ?? false;
    var isSelected = this.Item.Equals(this.TreeViewContainer.SelectedItem);
}

<div class="hx-tree-view-item @(isSelected ? "selected" : "")" @onclick="@HandleItemClicked">
    @for (int i = 0; i < this.Level; i++)
    {
        <div class="hx-tree-view-item-spacer"></div>
    }
    <div class="hx-tree-view-item-expander @(this.IsExpanded ? "expanded" : "")">
        @if (hasChildren)
        {
            <div>
                <HxIcon Icon="@BootstrapIcon.ChevronRight" />
            </div>
        }
    </div>
    @if (icon != null)
    {
        <div class="hx-tree-view-item-icon">
            <HxIcon Icon="@icon" />
        </div>
    }
    <div title="@title" class="hx-tree-view-item-title text-nowrap text-truncate">@title</div>
</div>

@if (this.IsExpanded && hasChildren)
{
    foreach (var item in children)
    {
        <HxTreeViewItemInternal TItem="TItem"
                        Item="item"
                        TitleSelector="this.TitleSelector"
                        IconSelector="this.IconSelector"
                        ChildrenSelector="this.ChildrenSelector"
                        Level="@(this.Level + 1)"
                        OnItemSelected="this.OnItemSelected" />
    }
}